{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Museums - Email Verification</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <style>
        .verification-container {
            max-width: 500px;
            margin: 100px auto;
            padding: 2rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .verification-status {
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-weight: 600;
        }
        
        .verification-status.pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        .verification-status.verified {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .auth-code {
            font-size: 2rem;
            font-family: monospace;
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            letter-spacing: 0.2em;
            border: 2px solid #007bff;
        }
        
        .instructions {
            background: #e9ecef;
            padding: 1.5rem;
            border-radius: 4px;
            margin: 1.5rem 0;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #495057;
        }
        
        .instructions ol {
            text-align: left;
            margin: 1rem 0;
        }
        
        .instructions li {
            margin: 0.5rem 0;
        }
        
        .email-address {
            font-weight: 600;
            color: #007bff;
        }
        
        .back-link {
            margin-top: 2rem;
        }
        
        .back-link a {
            color: #6c757d;
            text-decoration: none;
        }
        
        .back-link a:hover {
            text-decoration: underline;
        }
        
        .loading-dots {
            display: inline-block;
        }
        
        .loading-dots::after {
            content: '';
            animation: loading-dots 1.5s infinite;
        }
        
        @keyframes loading-dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            90%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="verification-container">
        <h1>Email Verification Required</h1>
        
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
        
        <div class="verification-status pending" id="verification-status">
            <span id="status-text">Waiting for email verification</span>
            <span class="loading-dots" id="loading-dots"></span>
        </div>
        
        <p>To complete your authentication, please send an email with the following code:</p>
        
        <div class="auth-code">{{ auth_code }}</div>
        
        <div class="instructions">
            <h3>Verification Instructions:</h3>
            <ol>
                <li>Copy the code above: <strong>{{ auth_code }}</strong></li>
                <li>Send an email to: <span class="email-address">verify@math.moshchuk.com</span></li>
                <li>In the email body, paste the code: <strong>{{ auth_code }}</strong></li>
                <li>Send the email and wait for verification</li>
            </ol>
            <p><strong>Note:</strong> You can send the email from any email client or service. The verification is automatic once we receive your email.</p>
        </div>
        
        <div class="back-link">
            <a href="{% url 'advanced_auth' %}">‚Üê Back to Login</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const statusElement = document.getElementById('verification-status');
            const statusText = document.getElementById('status-text');
            const loadingDots = document.getElementById('loading-dots');
            
            // Check verification status every 3 seconds
            function checkVerificationStatus() {
                fetch('{% url "verification_status" %}', {
                    method: 'GET',
                    credentials: 'same-origin'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.verified) {
                        statusElement.className = 'verification-status verified';
                        statusText.textContent = 'Email verified! Redirecting...';
                        loadingDots.style.display = 'none';
                        
                        // Redirect after a short delay
                        setTimeout(() => {
                            window.location.href = '{% url "email_verification" %}';
                        }, 2000);
                    } else {
                        // Continue checking
                        setTimeout(checkVerificationStatus, 3000);
                    }
                })
                .catch(error => {
                    console.error('Error checking verification status:', error);
                    // Continue checking despite errors
                    setTimeout(checkVerificationStatus, 5000);
                });
            }
            
            // Start checking after 2 seconds
            setTimeout(checkVerificationStatus, 2000);
        });
    </script>
</body>
</html>
